<!doctype html>
<html>
    <head>
        <title>MatrixRTC Widget</title>
        <meta charset="utf-8" />
        <script src="$GODOT_URL"></script>
        <script type="module">
            import { createMatrixRTCSdk } from "./dist/matrixrtc-sdk.js";

            console.log("HELLO");
            const APPLICATION = "com.github.toger5.rtc-application-type"; // rtc application type

            var engine = new Engine($GODOT_CONFIG);
            engine.startGame();

            console.log("matrixRTCSdk before create");
            window.matrixRTCSdk = await createMatrixRTCSdk(APPLICATION).catch(
                (e) => {
                    console.error("createMatrixRTCSdk", e);
                },
            );
            console.log("matrixRTCSdk after create");

            // Rename to a var without `$` to be comaptible with godot
            window.matrixRTCSdk.dataObs = window.matrixRTCSdk.data$;
            window.matrixRTCSdk.membersObs = window.matrixRTCSdk.members$;
            window.matrixRTCSdk.localMemberObs =
                window.matrixRTCSdk.localMember$;
            console.log("matrixRTCSdk before join");
            const connectionState = window.matrixRTCSdk.join();
            console.log("matrixRTCSdk after join");
        </script>
    </head>
    <body>
        <canvas id="canvas"></canvas>
    </body>
</html>
